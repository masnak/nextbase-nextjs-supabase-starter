---
title: 'Package Upgrade Plan v4â†’v5 Migration'
description: 'TanStack Query v4â†’v5, TypeScript ESLint v6â†’v8, TypeScript 5.8.3â†’5.9.2 è©³ç´°ç§»è¡Œè¨ˆç”»'
date: '2025-01-31'
author: 'Development Team'
version: '1.0'
priority: 'High'
estimated_duration: '1 é€±é–“'
tags: ['migration', 'typescript', 'react-query', 'eslint', 'breaking-changes']
---

# ğŸ“¦ Package Upgrade Migration Plan

## ğŸ¯ æ¦‚è¦

### ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

- **@tanstack/react-query**: 4.36.1 â†’ 5.84.0 (MAJOR)
- **@typescript-eslint**: 6.21.0 â†’ 8.38.0 (MAJOR)
- **TypeScript**: 5.8.3 â†’ 5.9.2 (MINOR)
- **@hookform/resolvers**: 3.10.0 â†’ 5.2.1 (MAJOR)

### å½±éŸ¿ã‚¹ã‚³ãƒ¼ãƒ—

- **é«˜å½±éŸ¿**: èªè¨¼ãƒ•ãƒ­ãƒ¼ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã€å‹ãƒã‚§ãƒƒã‚¯
- **ä¸­å½±éŸ¿**: ESLintãƒ«ãƒ¼ãƒ«ã€ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **ä½å½±éŸ¿**: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

## ğŸš¨ BREAKING CHANGES ã‚µãƒãƒªãƒ¼

### TanStack Query v5

1. **APIå½¢å¼çµ±ä¸€**: ã™ã¹ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã«å¤‰æ›´
2. **ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‰Šé™¤**: onSuccess, onError, onSettledå‰Šé™¤
3. **çŠ¶æ…‹ãƒ•ãƒ©ã‚°å¤‰æ›´**: isLoading â†’ isPending, isPreviousData â†’ isPlaceholderData
4. **Infinite Query**: initialPageParamå¿…é ˆ

### TypeScript ESLint v8

1. **è¨­å®šã‚·ã‚¹ãƒ†ãƒ **: flat configæ¨å¥¨ã€projectServiceå°å…¥
2. **ãƒ«ãƒ¼ãƒ«ç½®æ›**: ban-typesåˆ†å‰²ã€prefer-ts-expect-erroréæ¨å¥¨
3. **TypeScript 5.9.2**: æ–°strictãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ

### TypeScript 5.9.2

1. **strict mode**: æš—é»™çš„anyå‹ã‚¨ãƒ©ãƒ¼
2. **å‹æ¨è«–å¼·åŒ–**: ã‚ˆã‚Šå³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯

## ğŸ“‹ æ®µéšçš„å®Ÿè¡Œãƒ—ãƒ©ãƒ³

### Phase 1: åŸºç›¤æ•´å‚™ (1æ—¥)

#### 1.1 äº‹å‰æº–å‚™

    # GitçŠ¶æ…‹ç¢ºèªã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    git status
    git stash push -m "Before major upgrade"
    git checkout -b upgrade/major-packages-v5

#### 1.2 ä¾å­˜é–¢ä¿‚ç¢ºèª

    # ç¾åœ¨ã®ä¾å­˜é–¢ä¿‚ç¢ºèª
    pnpm list --depth=0
    pnpm outdated

#### 1.3 ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™

    # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç¢ºèª
    pnpm test
    pnpm build
    pnpm lint

### Phase 2: React Query v4â†’v5 ç§»è¡Œ (2-3æ—¥)

#### 2.1 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

    # React Query v5ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    pnpm update @tanstack/react-query@5.84.0

#### 2.2 è‡ªå‹•ç§»è¡Œãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ

    # å…¬å¼ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒƒãƒ‰é©ç”¨
    npx jscodeshift --extensions=ts,tsx \
      --parser=tsx \
      --transform=./node_modules/@tanstack/react-query/build/codemods/src/v5/remove-overloads/remove-overloads.cjs \
      src/

#### 2.3 æ‰‹å‹•ä¿®æ­£é …ç›®

**2.3.1 APIå½¢å¼ã®çµ±ä¸€**

å¤‰æ›´å‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³:
useQuery(key, fn, options)
useInfiniteQuery(key, fn, options)  
 useMutation(fn, options)

å¤‰æ›´å¾Œã®ãƒ‘ã‚¿ãƒ¼ãƒ³:
useQuery({ queryKey, queryFn, ...options })
useInfiniteQuery({ queryKey, queryFn, ...options })
useMutation({ mutationFn, ...options })

**2.3.2 ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‰Šé™¤ã¸ã®å¯¾å¿œ**

src/data/auth/auth.ts ãªã©ã§ä¿®æ­£:
// å¤‰æ›´å‰
useQuery({
queryKey: ['user'],
queryFn: fetchUser,
onSuccess: (data) => toast.success('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ!'),
onError: (error) => toast.error(error.message)
})

    // å¤‰æ›´å¾Œ - useEffectã§ä»£æ›¿
    const query = useQuery({
      queryKey: ['user'],
      queryFn: fetchUser
    })

    React.useEffect(() => {
      if (query.data && !query.isPending) {
        toast.success('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ!')
      }
    }, [query.data, query.isPending])

    React.useEffect(() => {
      if (query.error) {
        toast.error(query.error.message)
      }
    }, [query.error])

**2.3.3 çŠ¶æ…‹ãƒ•ãƒ©ã‚°ã®æ›´æ–°**

ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä¿®æ­£:
// Importè¿½åŠ 
import { keepPreviousData } from '@tanstack/react-query'

    // å¤‰æ›´å‰
    const { data, isLoading, isPreviousData } = useQuery({
      queryKey: ['items', page],
      queryFn: () => fetchItems(page),
      keepPreviousData: true
    })

    // å¤‰æ›´å¾Œ
    const { data, isPending, isPlaceholderData } = useQuery({
      queryKey: ['items', page],
      queryFn: () => fetchItems(page),
      placeholderData: keepPreviousData
    })

**2.3.4 Infinite Queryä¿®æ­£**

Infinite scrollingå®Ÿè£…ç®‡æ‰€ã§ä¿®æ­£:
// å¤‰æ›´å‰
useInfiniteQuery({
queryKey: ['projects'],
queryFn: ({ pageParam = 0 }) => fetchProjects(pageParam),
getNextPageParam: (lastPage) => lastPage.nextCursor
})

    // å¤‰æ›´å¾Œ
    useInfiniteQuery({
      queryKey: ['projects'],
      queryFn: ({ pageParam }) => fetchProjects(pageParam),
      initialPageParam: 0,
      getNextPageParam: (lastPage) => lastPage.nextCursor
    })

#### 2.4 ãƒ†ã‚¹ãƒˆä¿®æ­£

    # å„ä¿®æ­£å¾Œã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    pnpm test src/data/
    pnpm test src/hooks/

### Phase 3: TypeScript ESLint v6â†’v8 ç§»è¡Œ (1-2æ—¥)

#### 3.1 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

    # ESLinté–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ›´æ–°
    pnpm update @typescript-eslint/eslint-plugin@8.38.0 @typescript-eslint/parser@8.38.0

#### 3.2 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç§»è¡Œ

**3.2.1 æ–°ã—ã„flat configå°å…¥**

eslint.config.jsä½œæˆ:
import tseslint from 'typescript-eslint'

    export default tseslint.config(
      ...tseslint.configs.recommendedTypeChecked,
      {
        languageOptions: {
          parserOptions: {
            projectService: true,
            tsconfigRootDir: import.meta.dirname
          }
        },
        rules: {
          // ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«è¨­å®š
          '@typescript-eslint/no-unused-vars': 'error',
          '@typescript-eslint/no-explicit-any': 'warn'
        }
      }
    )

**3.2.2 éæ¨å¥¨ãƒ«ãƒ¼ãƒ«ç½®æ›**

è‡ªå‹•ç½®æ›ãƒãƒƒãƒ”ãƒ³ã‚°:
'@typescript-eslint/ban-types' â†’ å‰Šé™¤
'@typescript-eslint/no-empty-object-type' â†’ è¿½åŠ 
'@typescript-eslint/no-unsafe-function-type' â†’ è¿½åŠ   
 '@typescript-eslint/no-wrapper-object-types' â†’ è¿½åŠ 
'@typescript-eslint/no-var-requires' â†’ '@typescript-eslint/no-require-imports'
'@typescript-eslint/prefer-ts-expect-error' â†’ '@typescript-eslint/ban-ts-comment'

#### 3.3 æ–°æ©Ÿèƒ½æ´»ç”¨

**3.3.1 Project Serviceè¨­å®š**
TypeScriptè¨­å®šã®è‡ªå‹•æ¤œå‡ºã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š:
parserOptions: {
projectService: {
allowDefaultProject: ['*.js', '*.mjs'],
defaultProject: 'tsconfig.json'
}
}

### Phase 4: TypeScript strict ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ (2-3æ—¥)

#### 4.1 é‡è¦å‹ã‚¨ãƒ©ãƒ¼ä¿®æ­£

**4.1.1 Login/Signupã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

src/app/(dynamic-pages)/(login-pages)/(login-pages)/login/Login.tsx:
// å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°è¿½åŠ 
function isFormData(data: any): data is { email: string; password: string } {
return data && typeof data === 'object' && 'email' in data && 'password' in data
}

    // handleSubmitä¿®æ­£
    const handleSubmit = (data: FormEvent<HTMLButtonElement> | { email: string; password: string }) => {
      if (isFormData(data)) {
        executeLogin({
          email: data.email,
          password: data.password
        })
      }
    }

**4.1.2 ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‹å®šç¾©**

src/app/(dynamic-pages)/(login-pages)/(login-pages)/login/NewLogin.tsx:
// å…±é€šIconå‹å®šç¾©
interface IconProps extends React.SVGProps<SVGSVGElement> {
className?: string
}

    // å„ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¿®æ­£
    function ChromeIcon(props: IconProps) {
      return (
        <svg viewBox="0 0 24 24" {...props}>
          {/* SVG content */}
        </svg>
      )
    }

    function GithubIcon(props: IconProps) { /* åŒæ§˜ã®ä¿®æ­£ */ }
    function TwitterIcon(props: IconProps) { /* åŒæ§˜ã®ä¿®æ­£ */ }
    function XIcon(props: IconProps) { /* åŒæ§˜ã®ä¿®æ­£ */ }

src/app/Navbar.tsx:
function MountainIcon(props: IconProps) {
return (
<svg viewBox="0 0 24 24" {...props}>
{/_ SVG content _/}
</svg>
)
}

**4.1.3 AuthProviderå‹ä¸ä¸€è‡´ä¿®æ­£**

src/components/Auth/RenderProviders.tsxç¢ºèª:
// AuthProviderå‹å®šç¾©ã®ç¢ºèªã¨ä¿®æ­£
export type AuthProvider = 'google' | 'github' | 'twitter' | 'apple'

Login/Signupã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å‹åˆ¶ç´„:
// ã‚ˆã‚Šå³å¯†ãªå‹å®šç¾©
type SupportedProviders = Extract<AuthProvider, 'google' | 'github' | 'twitter'>

    const handleProviderLogin = (provider: SupportedProviders) => {
      // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    }

#### 4.2 æœªä½¿ç”¨å¤‰æ•°å‰Šé™¤

**4.2.1 è‡ªå‹•å‰Šé™¤å¯¾è±¡**
// src/app/(dynamic-pages)/(login-pages)/(login-pages)/login/Login.tsx:27
const nextActionType = ... // å‰Šé™¤

    // src/app/(dynamic-pages)/(login-pages)/(login-pages)/login/NewLogin.tsx:172
    const XIcon = ... // å‰Šé™¤ï¼ˆæœªä½¿ç”¨ã®å ´åˆï¼‰

    // å„pageã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    const { error } = ... // ä½¿ç”¨ã—ã¦ã„ãªã„å ´åˆã¯å‰Šé™¤

**4.2.2 ä½¿ç”¨çŠ¶æ³ç¢ºèª** # æœªä½¿ç”¨å¤‰æ•°æ¤œç´¢
pnpm lint --fix

#### 4.3 Next.jsæœ€é©åŒ–æ¨å¥¨å¯¾å¿œ

**4.3.1 Imageæœ€é©åŒ–**
// å¤‰æ›´å‰
<img src="/assets/logo.png" alt="Logo" />

    // å¤‰æ›´å¾Œ
    import Image from 'next/image'
    <Image src="/assets/logo.png" alt="Logo" width={200} height={50} />

**4.3.2 Linkæœ€é©åŒ–**  
 // å¤‰æ›´å‰
<a href="/">Home</a>

    // å¤‰æ›´å¾Œ
    import Link from 'next/link'
    <Link href="/">Home</Link>

### Phase 5: æœ€çµ‚æ¤œè¨¼ãƒ»æœ€é©åŒ– (1æ—¥)

#### 5.1 å…¨ä½“ãƒ†ã‚¹ãƒˆ

    # å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œ
    pnpm test

    # ãƒ“ãƒ«ãƒ‰ç¢ºèª
    pnpm build

    # å‹ãƒã‚§ãƒƒã‚¯
    pnpm tsc --noEmit

    # Lintç¢ºèª
    pnpm lint

#### 5.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª

    # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚é–“æ¸¬å®š
    time pnpm dev

    # ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºç¢ºèª
    pnpm build
    pnpm analyze # bundle analyzerç­‰ä½¿ç”¨

#### 5.3 æ–°æ©Ÿèƒ½æ´»ç”¨æ¤œè¨

**5.3.1 React Query v5æ–°æ©Ÿèƒ½**

- Simplified optimistic updates
- maxPages option for infinite queries
- New combine option for useQueries

**5.3.2 TypeScript ESLint v8æ–°æ©Ÿèƒ½**

- Project Service for better performance
- Enhanced type-aware linting
- Improved error messages

## ğŸ§ª ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

- [ ] ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°
- [ ] ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] èªè¨¼çŠ¶æ…‹ç®¡ç†

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

- [ ] åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°é€Ÿåº¦
- [ ] å‹ãƒã‚§ãƒƒã‚¯æ™‚é–“
- [ ] Lintå®Ÿè¡Œæ™‚é–“
- [ ] ãƒ“ãƒ«ãƒ‰æ™‚é–“

### äº’æ›æ€§ãƒ†ã‚¹ãƒˆ

- [ ] æ—¢å­˜APIã¨ã®äº’æ›æ€§
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§
- [ ] ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
- [ ] TypeScript strict mode
- [ ] ESLintè¨­å®š

## ğŸš¨ ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### é«˜ãƒªã‚¹ã‚¯é …ç›®

1. **èªè¨¼ãƒ•ãƒ­ãƒ¼ç ´ç¶»**: æ®µéšçš„ãƒ†ã‚¹ãƒˆã§æ—©æœŸç™ºè¦‹
2. **ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°å¤±æ•—**: React Queryç§»è¡Œå¾Œå³åº§ã«ç¢ºèª
3. **å‹ã‚¨ãƒ©ãƒ¼å¤§é‡ç™ºç”Ÿ**: TypeScript strictãƒ¢ãƒ¼ãƒ‰ã‚’æ®µéšçš„ã«é©ç”¨

### å¯¾ç­–

- å„Phaseå®Œäº†å¾Œã®æ¤œè¨¼å¿…é ˆ
- å•é¡Œç™ºç”Ÿæ™‚ã®å³åº§ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †æº–å‚™
- æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã®ååˆ†ãªæ¤œè¨¼

## ğŸ¯ æˆåŠŸãƒ¡ãƒˆãƒªã‚¯ã‚¹

### å®šé‡çš„æŒ‡æ¨™

- ãƒ“ãƒ«ãƒ‰æ™‚é–“: ç¾çŠ¶ç¶­æŒã¾ãŸã¯æ”¹å–„
- å‹ã‚¨ãƒ©ãƒ¼æ•°: 0ä»¶é”æˆ
- Lintè­¦å‘Šæ•°: 50%ä»¥ä¸Šå‰Šæ¸›
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸: ç¾çŠ¶ç¶­æŒ

### å®šæ€§çš„æŒ‡æ¨™

- é–‹ç™ºä½“é¨“ã®å‘ä¸Š
- å‹å®‰å…¨æ€§ã®å‘ä¸Š
- ã‚¨ãƒ©ãƒ¼ç™ºè¦‹ã®æ—©æœŸåŒ–
- å°†æ¥ã®æ©Ÿèƒ½è¿½åŠ ã®å®¹æ˜“ã•

## ğŸ“š å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- TanStack Query v5 Migration Guide
- TypeScript ESLint v8 Migration Guide
- TypeScript 5.9 Release Notes
- React Hook Form Resolvers v5 Changes

### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒªã‚½ãƒ¼ã‚¹

- TypeScript ESLint Discord #v8ãƒãƒ£ãƒ³ãƒãƒ«
- TanStack Query GitHub Discussions
- Next.jså‡çº§æœ€ä½³å®è·µ

## ğŸ“ å¤‰æ›´å±¥æ­´

| Date       | Version | Changes      | Author           |
| ---------- | ------- | ------------ | ---------------- |
| 2025-01-31 | 1.0     | åˆæœŸè¨ˆç”»ä½œæˆ | Development Team |

---

**æ³¨æ„**: ã“ã®è¨ˆç”»ã¯ live document ã¨ã—ã¦ã€å®Ÿè£…ä¸­ã«ç™ºè¦‹ã•ã‚ŒãŸèª²é¡Œã«å¿œã˜ã¦æ›´æ–°ã•ã‚Œã¾ã™ã€‚å„Phaseå®Œäº†æ™‚ã«é€²æ—ã¨èª²é¡Œã‚’è¨˜éŒ²ã—ã€å¿…è¦ã«å¿œã˜ã¦è¨ˆç”»ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚
